<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Conversas - SafraGO</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f4f4f4;
        }
        header {
            background: #218838;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 20px;
        }
        #lista {
            padding: 15px;
        }
        .card {
            background: white;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .card:hover {
            background: #e9ffe9;
        }
        .ultima {
            color: #555;
            font-size: 14px;
        }
        .info {
            font-size: 13px;
            color: #888;
        }
    </style>
</head>
<body>

    <header>Minhas Conversas</header>

    <div id="lista"></div>

    <script type="module">
        import { carregarConversas } from "../js/chat.js";
        import { getSession } from "../js/firebaseConfig.js";

        async function carregar() {
            const sess = await getSession();
            if (!sess) {
                alert("Faça login primeiro!");
                return;
            }

            const conversas = await carregarConversas();
            const lista = document.getElementById("lista");
            lista.innerHTML = "";

            conversas.forEach(c => {
                const outroUid = (c.comprador_uid === sess.uid) ? c.vendedor_uid : c.comprador_uid;

                const div = document.createElement("div");
                div.className = "card";
                div.onclick = () => {
                    window.location = "chat.html?id=" + c.id + "&dest=" + outroUid;
                };

                div.innerHTML = `
                    <b>Conversa #${c.id}</b><br>
                    <span class="info">Com: ${outroUid}</span><br>
                    <span class="ultima">Última mensagem: ${c.ultima_msg || "(vazia)"}</span>
                `;

                lista.appendChild(div);
            });
        }

        carregar();
        setInterval(carregar, 2000); // Atualiza a cada 2s
    </script>

</body>
</html>
